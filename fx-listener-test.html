<!--
    Copyright 2014 The Chromium Authors. All rights reserved.
    Use of this source code is governed by a BSD-style license that can be
    found in the LICENSE file.
 -->
<link rel="import" href="fx-listener.html">

<script>
"use strict";

describe("fx-listener", function() {
    var container;

    beforeEach(function() {
        container = document.body.appendChild(document.createElement("div"));
    });

    afterEach(function() {
        if (container)
            container.remove();
        container = null;
    });

    it("should listen for events on the window", function() {
        var events = [];
        var listener = new FxListener();
        listener.setAttribute("on-test-event", "ignored");
        listener.addEventListener("test-event", function(event) {
            events.push(event);
        });
        window.dispatchEvent(new CustomEvent("test-event"));
        container.appendChild(listener);
        var event = new CustomEvent("test-event");
        window.dispatchEvent(event);
        listener.remove();
        window.dispatchEvent(new CustomEvent("test-event"));
        assert.equal(events.length, 1);
        assert.equal(events[0].detail, event);
    });

    it("should listen for events on child objects", function() {
        var events = [];
        var listener = new FxListener();
        listener.target = "document.body";
        listener.setAttribute("on-click", "ignored");
        listener.addEventListener("click", function(event) {
            events.push(event);
        });
        document.body.click();
        container.appendChild(listener);
        document.body.click();
        listener.remove();
        document.body.click();
        assert.equal(events.length, 1);
    });
});
</script>
